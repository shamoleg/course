# АРХИТЕКТУРА ROS

## Граф вычислений

ROS представляет собой модульную структуру, состоящую из множества узлов, где каждый узел выполняет одну небольшую функцию обработки данных. Например, один узел принимает данные от дальномера, другой узел управляет двигателем, еще один выполняет планирование маршрута и т.п.

Вычисления в ROS выполняются с использованием сети процессов, называемых узлами(ROS nodes). Основными элементами графа являются узлы (Nodes), мастер(Master), сервер параметров (Parameter Server), сообщения (messages), сервисы (services), темы (topics) и мешки (bags).

**Узел (Node)**. Узлы – это программные процессы, которые выполняют вычисления.  Программа узла пишется с использованием библиотеки ROS, такой как roscpp или rospy. В роботе много узлов для выполнять различные виды задач. Используя методы связи ROS, он может связываться друг с другом и обмениваться данными. Одна из целей узлов ROS - создавать простые процессы, а не большой процесс со всеми функциями. Будучи простой структурой, узлы ROS легко отлаживать и модифицировать.

**Сообщения (Messages)**. Узлы могут общаться друг с другом с
помощью сообщений. Сообщение – это структура данных, включающая типизированные поля. Поддерживаются стандартные при-
митивные типы (integer, floating point, boolean и т.п.), а также массивы примитивных типов. Сообщения могут включать произвольно сложные структуры и массивы.

**Темы (Topics)**. Сообщения в ROS организуются по темам.
Идея состоит в том, что узел, который хочет передавать информацию, будет публиковать сообщения по соответствующей теме
или темам. А узел, который хочет получать информацию, будет подписываться на интересующую тему или темы. Для одной темы может быть одновременно несколько узлов-источников (издателей) и узлов-получателей (подписчиков) информации. В целом издатели и подписчики не знают о существовании друг друга.
Организацией взаимодействия между ними занимается мастер ROS. Каждая тема имеет имя, и каждый узел может
подключиться к тема для отправки или получения сообщений.

**Мастер (Master)**. Мастер ROS обеспечивает регистрацию имени и поиск остальной части графа вычислений. Без мастера узлы не смогут находить друг друга, обмениваться сообщениями  и вызывать службы.
Мастер ROS работает как служба имен в графе вычислений.
Мастер хранит информацию о регистрации тем и сервисов для узлов  ROS. Узлы общаются с мастером для передачи ему регистрационной информации. Также мастер сообщает узлам о других зарегистрированных (и вновь появившихся) узлах, и тогда узлы могут устанавливать соединения друг с другом. Узлы соединяются с другими узлами напрямую, мастер предоставляет только информацию о поиске, подобно DNS-серверу. Узлы, которые подписываются на тему, будут запрашивать соединения с узлами, публикующимися на эту тему. Протокол, по которому устанавливается соединение, называется TCPROS; он использует стандартные сокеты TCP/IP.

## Файловая система

Файловая система определяет ресурсы, которые
хранятся на диске. Выделены следующие элементы файловой
системы ROS.

**Пакеты (Packages)**. Пакет – это набор логически связанных файлов.
Все программное обеспечение ROS организовано в пакеты.

**Метапакеты (Metapackages)**. Метапакеты являются специализированными пакетами, которые служат только для представления группы пакетов, связанной одной задачей.

**Манифест (Package manifest)**. Манифест – это файл (package.xml),
служащий для определения зависимостей между пакетами и содержащий данные о пакете (имя, версия,
описание, зависимости).

**Cообщения (Message)**. Сообщения определяет структуру данных сообщения,
передаваемого в ROS.

**Cервисы (Service)**. Сервис определяет структуру данных запроса и ответа для сервиса.

| Название            | Описание |
| -                   | -        |
| config              | Эта папка содержит все конфигурационные файлы необходимыые для пакета
| include             | Эта папка содержит все заголовочные файлы и библиотеки
| scripts             | Эта папка содержит исполняемые файлы Python скриптов
| src                 | Эта папка содержит исходные код C++ программ
| launch              | Эта папка содержит файлы с расширением(.launch) для запуска одного или нескольких узлов(ROS nods)
| msg                 | Эта папка содержит пользовательские определения сообщений.
| srv                 | Эта папка содержит пользовательские определения сервисов.
| action              | Эта папка содержит пользовательские определения действия.
| package.xml         | Это файл манифеста пакета.
| CMakeLists.txt      | Это файл сборки CMake пакета.

## КОМАНДЫ ROS

Имена всех команд ROS начинаются с приставки ros, вторая часть имени команды отражает смысловое значение и часто
является копией команды в Linux. Например:

`roscd = ros+cd`

`rosls = ros+ls`

## Команды работы с файловой системой

`rospack` – получение информации о пакетах ROS. Реализует широкий спектр команд: размещение пакетов ROS в файловой
системе, поиск и перечисление доступных пакетов, вычисление
дерева зависимостей пакетов.

`roscd <packet_name>` – изменение директории с ис-
пользованием имени пакета.

`rosls <packet_name>` – вывод содержимого директории
пакета или списка пакетов.
В командной строке ROS работает завершение написания
команд с помощью клавиши Tab, как в Linux.

## Команды работы с узлами

`roscore` – запускает набор узлов и программ, которые требуются для работы ROS. При старте roscore запускаются: мастер ROS, сервер параметров ROS, узел журналирования (записи опроисходящих событиях) rosout.

`rosnode` – набор команд для вывода информации о узлах ROS, которые запущены в системе. Поддерживаются команды:

`rosnode info <node_name>` – вывод информации об узле `<node_name>`;

`rosnode kill <node_name>` – завершение работы узла `<node_name>`;

`rosnode list` – вывод списка активных узлов;

`rosnode cleanup` – удаление регистрационной информации обо всех узлах, которые недоступны на данный момент.

`rosrun <package_name> <executable_name>` – команда позволяет запустить исполняемый файл в произвольном
пакете из любого места без необходимости указания полного пути до этого пакета. Параметр `<package_name>` – имя пакета,
`<executable_name>` – имя исполняемого файла.

ROS требует, чтобы каждый узел имел уникальное имя.

## Команды работы с темами и зависимостями между узлами

Зависимости между узлами, запущенными в данный момент,
в виде графа вычислений можно посмотреть с помощью приложения `rqt_graph`. Утилита `rqt_graph` входит в фреймворк rqt.
Фреймворк rqt основан на Qt и используется для разработки графического интерфейса в ROS. Граф вычислений выводится в отдельном окне командой
`rosrun rqt_graph rqt_graph`

Команда `rostopic` позволяет получить информацию о темах в ROS. rostopic имеет следующий набор подкоманд:

`rostopic echo </topic_name>` – вывод потока данных, опубликованных в указанную тему;

`rostopic list </topic_name]` – вывод списка опубликованных тем с указанием издателей и подписчиков;

`rostopic type </topic_name>` – вывод типа сообщения для любой опубликованной темы.

`rosmsg show <message_data_type_name>`. Тип данных сообщения имеет составное имя, состоящее из имени пакета
и имени типа данных сообщения

`rostopic pub </topic_name> <message_name> <args>` – публикация данных в указанную тему. В параметрах
команды указывают имя темы, имя сообщения и аргументы, которые передаются в сообщении (зависят от параметров конкретного сообщения);

Для просмотра значений отдельных переменных выбранной
темы в виде графика, можно использовать утилиту `rqt_plot`'

Для просмотра изображения, можно использовать утилиту `rqt_image_view`.

`rosparam` – команда позволяет хранить и управлять данными на сервере параметров ROS. Сервер параметров работает
со следующими типами: целочисленные, с плавающей точкой,
булевы, словари и списки. Команда rosparam в качестве синтаксиса использует язык разметки YAML. Команда rosparam содержит
следующие подкоманды:
`rosparam list` – вывод списка имен параметров;

`rosparam get <parameter_name>` – получить значение параметра;

`rosparam set <parameter_name> <parameter_value>` – задать значение параметра;

`rosparam load <file_name>` – загрузить значения всех параметров из файла.

Команды работы с типами сообщений (файлы msg)

## Команды работы с типами сообщений (файлы msg)

`rosmsg` – команда получения информации о типах сообще-
ний ROS. rosmsg содержит следующие подкоманды:

`rosmsg list` – вывод всех сообщений всех пакетов;

`rosmsg show <message_data_type_name>` – вывод типа данных сообщения. Тип данных сообщения имеет составное имя, состоящее из имени пакета и имени типа данных сообщения
